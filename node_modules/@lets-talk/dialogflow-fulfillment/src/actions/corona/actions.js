const { AdaptorexService } = require("../../services/adaptorex_service");
const { CPFService } = require("../../services/cpf_service");
const constants = require("./../../constants");

const RISK_GROUP_ARRAY = {
    "1_1_1_1_1": 2,
    "1_1_1_1_0": 2,
    "1_1_1_0_0": 2,
    "1_1_0_0_0": 1,
    "1_0_0_0_0": 3,
    "1_1_0_1_1": 2,
    "1_0_1_1_1": 2,
    "1_1_1_0_1": 2,
    "1_0_1_0_1": 2,
    "1_1_0_0_1": 1,
    "1_0_0_1_1": 2,
    "1_0_0_1_0": 1,
    "1_0_1_0_0": 2,
    "1_0_0_0_1": 3,
    "1_1_0_1_0": 1,
    "0_1_1_1_1": 2,
    "0_1_1_1_0": 2,
    "0_1_1_0_0": 2,
    "0_1_0_0_0": 1,
    "0_0_0_0_0": 0,
    "0_1_0_1_1": 2,
    "0_0_1_1_1": 2,
    "0_1_1_0_1": 2,
    "0_0_1_0_1": 2,
    "0_1_0_0_1": 1,
    "0_0_0_1_1": 2,
    "0_0_0_1_0": 1,
    "0_0_1_0_0": 2,
    "0_0_0_0_1": 0,
    "0_1_0_1_0": 1,
    "0_0_1_1_0": 2,
    "1_0_1_1_0": 2,
  };

function getRiskGroup(params){
    const contact = params.extra.response_contacto;
    const breath = params.extra.response_respiratoria;
    const sintoms = params.extra.response_sintomas;
    const fever = params.extra.response_fiebre;
    const conditions = params.extra.response_condiciones;
    const key = `${contact}_${sintoms}_${breath}_${fever}_${conditions}`;
    return RISK_GROUP_ARRAY[key];
  }

async function evaluateCorona(params) {
    const group = getRiskGroup(params);
    const msg = params["coronaTestResponses"][group]
    const messages = [msg];
    switch(params.provider) {
        case constants.providers.twilio:
          await AdaptorexService.addMessages(params, messages);
          break;
        case constants.providers.lt:
          await CPFService.addMultipleMessages(params, messages);
          break;
    }
}


exports.evaluateCorona = evaluateCorona;