const helpers = require("./helpers");
const dialogflow_service = require("./../../services/dialogflow");
const { AdaptorexService } = require("./../../services/adaptorex_service");

const loggerHelper = require("./../../helpers/logger");

const logger = loggerHelper.getLogger("WASTActions");

async function evaluateWAST(params) {
    const result = helpers.calc_sum_wast(params)
    logger.info("WAST result", { result: result });
    if (result === -1) {
        await errorWAST(params);
    }
    else if (result >= 15) {
        await AdaptorexService.addMessage(params, params["messageWASTPositive"]);
    } else {
        await AdaptorexService.addMessage(params, params["messageWASTNegative"]);
    }
    await dialogflow_service.deleteAllContexts(params);
}


async function errorWAST(params) {
    await dialogflow_service.deleteAllContexts(params);
    await AdaptorexService.addMessage(params, params["messageWASTError"]);
}


async function resetWAST(params) {
    await dialogflow_service.deleteAllContexts(params);
    await AdaptorexService.addMessage(params, params["messageWASTReset"]);
}

exports.evaluateWAST = evaluateWAST;
exports.resetWAST = resetWAST;