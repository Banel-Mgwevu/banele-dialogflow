const schemas = require("../../src/helpers/schemas");


describe('validateSettings', () => {
    describe('When valid configuration', () => {

      it('Should return true', () => {
        expect.assertions(1);
        const validSettings = {
          organization: 'normaliza',
          project: 'ABC-123',
          token: 'token-123',
          environment: 'production',
          availability: {
            opening_times: {
              mon: ['10:00', '12:00'],
              tue: ['10:00', '12:00'],
              wed: ['10:00', '12:00'],
              thu: ['10:00', '12:00'],
              fri: ['10:00', '12:00'],
              sat: ['10:00', '12:00'],
              sun: ['10:00', '12:00'],
              "2020-01-01": [],
              "2020-12-25": [],
            },
            timezone: 'America/Santiago',
          },
          actions: {
            "input.transfer.inbound": {
              "method": "transferConversation",
              "params": {
                "group_id": 2455,
                "messages": {
                  "accept": [
                    "Tu conversación está siendo derivada con uno de nuestros ejecutivos."
                  ],
                  "reject": [
                    "Estimado cliente, actualmente no podemos tomar su solicitud por fuera de horario. Favor volver a contactarse de Lunes a Jueves entre las 9:00 - 17:50 y viernes entre las 9:00 - 15:00. Gracias por su comprensión.",
                    "¿Le puedo ayudar con algo más?"
                  ]
                },
                "project_list": [
                  "Inbound-sitio-publico"
                ]
              }
            },
          }
        };

        const result = schemas.validateSettings(validSettings);

        expect(result).toBeTruthy();
      });
    });

    describe('When invalid settings', () => {

      it('Should throw an error', () => {
        const invalidSettings = {
          organization: 'normaliza',
          project: 'ABC-123',
          token: 'token-123',
          environment: 'production',
          availability: {
            opening_times: {
              mon: ['10:00', '12:00'],
              tue: ['10:00', '12:00'],
              wed: ['10:00', '12:00'],
              thu: ['10:00', '12:00'],
              fri: ['10:00', '12:00'],
              sat: ['10:00', '12:00'],
              sun: ['10:00', '12:00'],
            },
            timezone: 'America/Santiago',
          },
          actions: {
            "input.transfer.inbound": {
              "nomethod": "transferConversation",
              "paramss": {}
            },
          }
        };

        expect(() => {
          expect.assertions(1);
          schemas.validateSettings(invalidSettings)
        }).toThrow('actions[\"input.transfer.inbound\"].params is a required field');
      });
    });
  });
